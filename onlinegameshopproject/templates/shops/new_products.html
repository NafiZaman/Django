{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% include 'bootstrap4/layout/help_text_and_errors.html' %}

{% block content %}
    <h1 class="p-3">Add new products to your store</h1>

    {% if products %}
        <section>
            <div class="container">
                <div class="row row-cols-lg-4">
                    {% for p in products %}
                        <div class="col mb-3">
                            <div class="card" style="width: 17rem;">
                                <img src="{{p.box_art}}" style="width:100%; height:15vw; object-fit:cover;" alt="{{p.name}}">
                                <div class="card-body">
                                    <h5 class="card-title text-truncate text-decoration-underline">{{p.name}}</h5>
                                    
                                    {% comment %} <div class="p-0 container text-truncate mb-3">
                                        <strong>Release Date:</strong> {{p.release_date}}
                                    </div>  {% endcomment %}

                                    {% comment %} <form action="{% url 'products:view_product' p.id %}" method="get">
                                        <button type="submit" class="btn btn-warning">View Game</button>
                                    </form> {% endcomment %}
                                    {% comment %} <button type="button" class="btn btn-success" id="{{p.form.id}}">View</button> {% endcomment %}

                                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal{{p.id}}">View</button>

                                    <!-- Modal Start -->
                                    <div class="modal fade" id="exampleModal{{p.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">Add new product</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <p class="lead"><strong>Product: </strong>{{p.name}}</p>
                                                    <p class="text-danger"><strong>'*' = Required field</strong></p>
                                                    <strong style></strong>
                                                    <form action="" method="POST">
                                                        {% csrf_token %}
                                                        {{p.form|crispy}}
                                                        <div class="modal-footer">
                                                            <button type="submit" class="btn btn-info" name="add" value={{p.id}}>Add to shop</button>
                                                        </div>                                             
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Modal End -->

                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </section>
    {% endif %}

    {% comment %} {% if add_product_form %}
        <div style='background-color: rgba(0,0,0,0.5);
                    z-index: 2;
                    position: fixed;
                    left: 0;
                    top: 0;
                    bottom: 0;
                    width: 100vw;
                    height: 100vh;
                    text-align: center;
                    display: flex;
                    align-items: center;
                    align-content: center;
                    justify-content: center;'>
            <form action="" method="post">
                {% csrf_token %}
                <div style="background: url('{{add_product_form.box_art}}'); background-size:100% 100%; width:11vw; height:28vh; margin:0 auto;"></div>
                {{add_product_form.as_p}}
                <button type="submit" name='add_product' value={{ add_product_form.id }}>Add Product</button>
                <input type="submit" name='cancel_add_product' value="Cancel" formnovalidate>
            </form><br>
        </div>
    {% endif %}


    {% if new_products %}
        <form action="" method="get">
            {% for p in new_products %}
                <div style="background: url('{{p.box_art}}'); background-size:100% 100%; width:11vw; height:28vh;"></div>
                <label for="add_product">{{p.name}}</label>
                <button type="submit" name='add_to_store' value={{p.id}}>Add to store</button><br><br>
            {% endfor %}
        </form>

    {% endif %}   {% endcomment %}
{% endblock %}